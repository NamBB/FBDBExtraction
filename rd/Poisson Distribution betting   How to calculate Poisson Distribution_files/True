
$(document).ready(function(){PSLOGIN.relocatePopupBox();PSLOGIN.init();});var PSLOGIN=(function(login,$){login.relocatePopupBox=function(){var overlayDiv=$('#loginOverlay');var popupBoxDiv=$('#loginPopupBox');$('body').append(overlayDiv);$('body').append(popupBoxDiv);};login.init=function(){var isSecure=($(location).attr("protocol").indexOf('https')>-1)?true:false;if(isSecure){$(".loginSubmit").on('click',login.ajaxSubmitHandler);$('.loginPopupBox').on('click','.loginSubmit',login.ajaxSubmitHandler);$('.loginPopupBox').on('submit','#passwordResetForm',login.resetPasswordHandler);$('.loginPopupBox').on('click','.loginNext',login.nextLinkHandler);$('.loginPopupBox').on('click','.closeLink',login.closeOverlay);$(window).resize(login.adjustOverlay);}else{$(".loginSubmit").on('click',login.submitHandler);}
login.setFocus();};login.setFocus=function(){var targetInput=$('.loginForm .customerId');if(!targetInput.is(':focus')){targetInput.focus();}};login.postUrl=function(){return"https://"+ window.location.hostname + $('#PostAction').val();};login.submitHandler=function(event){var form=$(this).parents('form');event.preventDefault();var loadingImage=form.find('.loginLoading');var submitButton=form.find('.loginSubmit, .loginPopupContent .loginSubmit');loadingImage.removeClass('hidden');submitButton.addClass('hidden');$(".aspNetHidden").remove();$('form').attr('action',login.postUrl());$('form').submit();};login.ajaxSubmitHandler=function(){var form=$(this).parents('form');var redirectToAction=($(this).attr("class")=='loginSubmit')?login.postUrl():form.attr('action');var isSecure=($(location).attr("protocol").indexOf('https')>-1)?true:false;var loadingImage=form.find('.loginLoading');var submitButton=form.find('.loginSubmit, .loginPopupContent .loginSubmit');if(isSecure&&redirectToAction.indexOf("http:")==0){redirectToAction="https:"+ redirectToAction.substr(5);}
$(".aspNetHidden").remove();loadingImage.removeClass('hidden');submitButton.addClass('hidden');$.ajax({url:redirectToAction,data:form.serialize(),type:"POST"}).done(function(data){login.showResponse(data);}).always(function(){loadingImage.addClass('hidden');submitButton.removeClass('hidden');});return false;};login.resetPasswordHandler=function(event){$.ajax({url:$(this).attr('action'),data:$(this).serialize(),type:"POST"}).done(function(data){login.showResponse(data);});event.preventDefault();return false;};login.nextLinkHandler=function(event){event.preventDefault();$.ajax({url:$(this).attr('href'),type:'GET'}).done(function(data){login.showResponse(data);});return false;};login.showResponse=function(result){if(login.IsValidUrl(result)){window.location=result;}
else{$('.loginOverlay').removeClass('hidden');$('.loginPopupBox').removeClass('hidden');var popupContent=$('.loginPopupContent');popupContent.html(result);popupContent.removeClass('hidden');login.adjustOverlay();}};login.adjustOverlay=function(){var popupContent=$('.loginPopupContent');popupContent.css('height','auto');popupContent.css('width',600);var contentHeight=$('.loginPopupContent').outerHeight();var windowHeight=$(window).height();var marginTop=contentHeight/2*-1;if(contentHeight>=windowHeight){popupContent.css('height',windowHeight - 40);popupContent.css('width',615);marginTop=(windowHeight - 40)/2*-1;$('.loginPopupBox').css('margin-top',marginTop);}else{$('.loginPopupBox').css('margin-top',marginTop);}};login.closeOverlay=function(event){event.preventDefault();$('.loginOverlay').addClass('hidden');$('.loginPopupBox').addClass('hidden');var popupContent=$('.loginPopupContent');popupContent.html("");popupContent.addClass('hidden');}
login.IsValidUrl=function(str){var pattern=new RegExp('^(https?:\\/\\/)?'+'((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|'+'((\\d{1,3}\\.){3}\\d{1,3}))'+'(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+'(\\?[;&a-z\\d%_.~+=-]*)?'+'(\\#[-a-z\\d_]*)?$','i');if(!pattern.test(str)){return false;}
else{return true;}};return login;}(PSLOGIN||{},jQuery));;
